<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>KummeraAI Cinematic Chat</title>

<!-- ================== CSS ================== -->
<style>
body {margin:0; padding:0; font-family:'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
 background:linear-gradient(135deg,#0f0c29,#302b63,#24243e); color:white; overflow-x:hidden; overflow-y:auto; transition:background 0.5s;}
body.light { background:linear-gradient(135deg,#ffffff,#e3e3ff); color:black;}

#bg-image {position:fixed; top:0; left:0; width:100%; height:100%; object-fit:cover; z-index:-1;}

#intro {position:fixed; top:0; left:0; width:100%; height:100%; display:flex; justify-content:center;
 align-items:center; background:linear-gradient(135deg,#0f0c29,#302b63,#24243e); flex-direction:column; z-index:100;}
#intro h1 {font-size:64px; letter-spacing:15px; display:flex;}
#intro h1 span {opacity:0; transform:translateY(-50px); animation:drop 0.6s forwards;}
#intro h1 span:nth-child(1){animation-delay:0.1s;} #intro h1 span:nth-child(2){animation-delay:0.2s;}
#intro h1 span:nth-child(3){animation-delay:0.3s;} #intro h1 span:nth-child(4){animation-delay:0.4s;}
#intro h1 span:nth-child(5){animation-delay:0.5s;} #intro h1 span:nth-child(6){animation-delay:0.6s;}
#intro h1 span:nth-child(7){animation-delay:0.7s;} #intro h1 span:nth-child(8){animation-delay:0.8s;}
#intro h1 span:nth-child(9){animation-delay:0.9s;}
@keyframes drop { to {opacity:1; transform:translateY(0);} }

/* Forms */
#user-form,#key-form,#personality-form {display:none; flex-direction:column; align-items:center; gap:15px; margin-top:30px;}
input {padding:10px 15px; border-radius:12px; border:none; font-size:16px; width:250px; text-align:center;}
button {padding:10px 20px; border-radius:12px; border:none; font-size:16px; cursor:pointer;
 background:linear-gradient(90deg,#ff00cc,#3333ff); color:white; transition:all 0.3s;}
button:hover{transform:scale(1.05);}

/* Messages */
#messages {display:flex; flex-direction:column; gap:12px; padding:20px; max-width:800px; margin:20px auto; padding-bottom:120px;}
.message {position:relative; padding:14px 20px; border-radius:999px; max-width:75%; word-wrap:break-word;
 font-size:16px; line-height:1.4; opacity:0; transform:scale(0.8); transition:all 0.4s ease; backdrop-filter:blur(12px);
 background-color:rgba(255,255,255,0.15); color:white; border:1px solid rgba(255,255,255,0.2); box-shadow:0 4px 20px rgba(0,0,0,0.15);}
.message.show {opacity:1; transform:scale(1);}
.message.user {align-self:flex-end; background: rgba(16,236,131,0.25); border:1px solid rgba(16,236,131,0.4);}
.message.ai {align-self:flex-start; background: rgba(255,95,109,0.25); border:1px solid rgba(255,95,109,0.4);}
body.light .message.user{color:black; background: rgba(16,236,131,0.25); border:1px solid rgba(16,236,131,0.4);}
body.light .message.ai{color:black; background: rgba(255,95,109,0.25); border:1px solid rgba(255,95,109,0.4);}

/* Typing dots */
.typing { display:inline-block; width:10px; height:10px; margin:0 2px; background:white; border-radius:50%;
 animation: bounce 1s infinite; }
.typing:nth-child(2) { animation-delay:0.2s; }
.typing:nth-child(3) { animation-delay:0.4s; }
@keyframes bounce {0%,80%,100%{transform:translateY(0);} 40%{transform:translateY(-8px);}}

/* Chat input */
#chat-input-container{position:fixed; bottom:10px; left:50%; transform:translateX(-50%);
 display:flex; gap:10px; width:90%; max-width:800px; z-index:50;}
#chat-input{flex:1; padding:12px 15px; border-radius:25px; border:none; font-size:16px;
 backdrop-filter:blur(12px); background:rgba(255,255,255,0.1); color:white; outline:none;}
#send-btn{padding:12px 20px; border-radius:25px; border:none; background:linear-gradient(90deg,#ff00cc,#3333ff);
 color:white; cursor:pointer; transition:all 0.3s;}
#send-btn:hover{transform:scale(1.05);}

/* Controls */
#controls{text-align:center; margin-top:20px;}
#controls input[type=color],#controls input[type=file]{margin-right:10px;}
</style>

<link href="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/themes/prism-tomorrow.css" rel="stylesheet"/>
<script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/prism.js"></script>
<script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-javascript.min.js"></script>
</head>
<body>
<img id="bg-image">

<div id="intro">
<h1>
<span>K</span><span>u</span><span>m</span><span>m</span><span>e</span><span>r</span><span>a</span><span>A</span><span>I</span>
</h1>
<div id="user-form">
<input type="text" id="username" placeholder="Enter your username">
<button onclick="submitUsername()">Continue</button>
</div>
</div>

<div id="key-form">
<p>Enter your OpenAI API key:</p>
<input type="text" id="apiKey" placeholder="Your API Key">
<p style="font-size:12px; color:rgba(255,255,255,0.7); max-width:300px; text-align:center;">
Your API key is stored locally and stays safe in your browser.
</p>
<button onclick="startAI()">Start AI</button>
</div>

<div id="personality-form">
<select id="ai-personality">
<option value="default">Default AI</option>
<option value="friendly">Friendly AI</option>
<option value="sarcastic">Sarcastic AI</option>
<option value="poetic">Poetic AI</option>
</select>
<button onclick="selectPersonality()">Select Personality</button>
<button onclick="surpriseMe()">Surprise Me!</button>
</div>

<div id="messages"></div>

<div id="chat-input-container" style="display:none;">
<input id="chat-input" placeholder="Type your message...">
<button id="send-btn">Send</button>
<button onclick="voiceInput()">ðŸŽ¤</button>
</div>

<div id="controls">
<input type="color" id="bgColor" title="Background Color">
<input type="file" id="bgFile" accept="image/*" title="Upload Background">
<button onclick="resetBackground()">Reset Background</button>
<button onclick="exportChat()">Export Chat</button>
<button onclick="clearChat()">Clear Chat</button>
<button onclick="toggleDark()">Dark/Light</button>
<button onclick="toggleMusic()">Music On/Off</button>
</div>

<audio id="bg-music" loop>
<source src="https://www.soundhelix.com/examples/mp3/SoundHelix-Song-1.mp3" type="audio/mpeg">
</audio>

<script>
// ---------------- Intro ----------------
window.onload = ()=>{ setTimeout(()=>{ document.getElementById('user-form').style.display='flex'; },1500); };
function submitUsername(){ const user=document.getElementById('username').value.trim();
 if(!user){alert("Enter username"); return;} sessionStorage.setItem('username',user);
 document.getElementById('intro').style.display='none'; document.getElementById('key-form').style.display='flex';}
function startAI(){ const key=document.getElementById('apiKey').value.trim();
 if(!key){alert("Enter API key"); return;} sessionStorage.setItem('apiKey',key);
 document.getElementById('key-form').style.display='none'; document.getElementById('personality-form').style.display='flex';}
function selectPersonality(){ const pers=document.getElementById('ai-personality').value;
 sessionStorage.setItem('personality',pers); document.getElementById('personality-form').style.display='none';
 document.getElementById('chat-input-container').style.display='flex';
 showMessage('ai',`Welcome ${sessionStorage.getItem('username')}! You can now chat with ${pers} KummeraAI.`);}
function surpriseMe(){const prompts=["Tell me a joke","Fun fact","Short poem","Fantasy scene"];
 const choice=prompts[Math.floor(Math.random()*prompts.length)]; selectPersonality(); sendMessageToAI(choice);}

// ---------------- Messages ----------------
function showMessage(sender,text,isTyping=false){
    const div=document.createElement('div'); div.className='message '+sender;
    if(isTyping){div.innerHTML='<span class="typing"></span><span class="typing"></span><span class="typing"></span>';}
    else{div.innerHTML=Prism.highlight(text,Prism.languages.javascript,'javascript');}
    document.getElementById('messages').appendChild(div);
    setTimeout(()=>{div.classList.add('show');},10);
    div.scrollIntoView({behavior:"smooth"}); return div;
}

// ---------------- AI Call ----------------
async function sendMessageToAI(message){
    const apiKey=sessionStorage.getItem('apiKey'); const username=sessionStorage.getItem('username');
    const personality=sessionStorage.getItem('personality')||"default"; if(!apiKey||!username) return;
    showMessage('user',message);
    const typingDiv=showMessage('ai','',true);
    try{
        const res=await fetch("https://api.openai.com/v1/chat/completions",{
            method:"POST",
            headers:{"Content-Type":"application/json","Authorization":`Bearer ${apiKey}`},
            body:JSON.stringify({model:"gpt-4o-mini", messages:[
                {role:"system", content:`You are a ${personality} AI chatting with ${username}.`},
                {role:"user", content:message}
            ]})
        });
        const data=await res.json(); const reply=data.choices[0].message.content;
        typingDiv.innerHTML=Prism.highlight(reply,Prism.languages.javascript,'javascript');
        speak(reply);
    }catch(err){typingDiv.innerText="Error: AI response failed."; console.error(err);}
}

// ---------------- Input ----------------
const chatInput=document.getElementById('chat-input'); const sendBtn=document.getElementById('send-btn');
sendBtn.onclick=()=>{const msg=chatInput.value.trim(); if(msg){sendMessageToAI(msg); chatInput.value='';}};
chatInput.addEventListener('keydown',e=>{if(e.key==='Enter'&&!e.shiftKey){e.preventDefault(); sendBtn.click();}});

// ---------------- Voice ----------------
function voiceInput(){
    const recognition=new (window.SpeechRecognition||window.webkitSpeechRecognition)();
    recognition.lang='en-US'; recognition.start();
    recognition.onresult=function(e){chatInput.value=e.results[0][0].transcript; sendBtn.click();};
}
function speak(text){ const synth=window.speechSynthesis; if(!synth) return;
 const utter=new SpeechSynthesisUtterance(text); synth.speak(utter);}

// ---------------- Background ----------------
const bgImage=document.getElementById('bg-image');
document.getElementById('bgColor').addEventListener('input',e=>{bgImage.src=''; document.body.style.background=e.target.value;});
document.getElementById('bgFile').addEventListener('change',e=>{const file=e.target.files[0]; if(!file)return;
 const reader=new FileReader(); reader.onload=ev=>{bgImage.src=ev.target.result;}; reader.readAsDataURL(file);});
function resetBackground(){bgImage.src=''; document.body.style.background='linear-gradient(135deg,#0f0c29,#302b63,#24243e)';}

// ---------------- Dark/Light ----------------
function toggleDark(){document.body.classList.toggle('light');}

// ---------------- Chat Export/Clear ----------------
function exportChat(){let text=Array.from(document.querySelectorAll('.message')).map(m=>m.innerText).join('\n');
 const blob=new Blob([text],{type:"text/plain"}); const url=URL.createObjectURL(blob); const a=document.createElement('a'); a.href=url; a.download="KummeraAI-chat.txt"; a.click(); URL.revokeObjectURL(url);}
function clearChat(){document.getElementById('messages').innerHTML='';}

// ---------------- Music ----------------
const bgMusic=document.getElementById('bg-music'); function toggleMusic(){bgMusic.paused?bgMusic.play():bgMusic.pause();}
</script>
</body>
</html>
